<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Buy/Sell Laam Token</title>
  <script src="https://cdn.jsdelivr.net/npm/albedo/dist/albedo.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 30px; max-width: 400px; margin: auto; }
    input, select, button { margin-top: 10px; width: 100%; padding: 10px; font-size: 16px; }
  </style>
</head>
<body>

  <h2>Buy/Sell Laam</h2>

  <button onclick="connectWallet()">Connect Wallet</button>
  <div id="wallet" style="margin: 10px 0;"></div>

  <select id="action">
    <option value="buy">Buy Laam</option>
    <option value="sell">Sell Laam</option>
  </select>

  <input type="number" id="amount" placeholder="Amount" />

  <button onclick="submitOffer()">Submit Offer</button>

  <script>
    let pubkey = null;
    const LAAM_ISSUER = "GAL4ECDAXNBMJYFCWIJ32HKVIRLCNEXY664CAZYI3EINQWPLXTMEPR64";

    function connectWallet() {
      albedo.publicKey({ token: "LAAM Connect" })
        .then(res => {
          pubkey = res.pubkey;
          document.getElementById("wallet").innerText = "Wallet: " + pubkey;
        })
        .catch(err => alert("Wallet connection failed."));
    }

    function submitOffer() {
      const amount = document.getElementById("amount").value;
      const action = document.getElementById("action").value;

      if (!pubkey || !amount) {
        alert("Connect wallet and enter amount");
        return;
      }

      const operation = {
        type: "manageBuyOffer",
        selling: action === "buy" ? {
          asset_code: "XLM"
        } : {
          asset_code: "Laam",
          asset_issuer: LAAM_ISSUER
        },
        buying: action === "buy" ? {
          asset_code: "Laam",
          asset_issuer: LAAM_ISSUER
        } : {
          asset_code: "XLM"
        },
        buy_amount: amount,
        price: "1"
      };

      albedo.tx({
        pubkey,
        network: "public",
        operations: [operation]
      })
      .then(res => alert("Transaction submitted"))
      .catch(err => alert("Failed: " + err.message));
    }
  </script>

</body>
</html>
